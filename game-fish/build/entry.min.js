function Bullet(t){this.type=t,this.x=0,this.y=0,this.rotate=0,this.iSpeed=10,this.move()}function Cannon(t){this.type=t,this.x=431,this.y=570,this.cur=0,this.rotate=0}function Coin(t){this.type=t,this.x=0,this.y=0,this.cur=0,this.move()}function a2d(t){return 180*t/Math.PI}function d2a(t){return t*Math.PI/180}function rnd(t,i){return parseInt(Math.random()*(i-t)+t)}function loadImg(t,i,e){for(var n=0,s=0;s<t.length;s++){var h=new Image;!function(s){h.onload=function(){JSON[t[s]]=this,n++,e&&e(n,t.length),n==t.length&&i&&i()}}(s),h.src="img/"+t[s]+".png"}}function DieFish(t){this.type=t,this.x=0,this.y=0,this.cur=0,this.rotate=0,this.change()}function Fish(t){this.type=t,this.x=0,this.y=0,this.rotate=0,this.cur=0,this.iSpeed=1,this.collR=FISH_SIZE[this.type].collR,this.move()}function Web(){this.x=0,this.y=0,this.scale=.5}var BULLET_SIZE=[null,{x:86,y:0,w:24,h:26},{x:62,y:0,w:25,h:29},{x:30,y:0,w:31,h:35},{x:32,y:35,w:27,h:31},{x:30,y:82,w:29,h:33},{x:0,y:82,w:30,h:34},{x:0,y:0,w:30,h:44}];Bullet.prototype.draw=function(t){var i=BULLET_SIZE[this.type].x,e=BULLET_SIZE[this.type].y,n=BULLET_SIZE[this.type].w,s=BULLET_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(JSON.bullet,i,e,n,s,-n/2,-s/2,n,s),t.restore()},Bullet.prototype.move=function(){setInterval(function(){this.x+=Math.sin(d2a(this.rotate))*this.iSpeed,this.y-=Math.cos(d2a(this.rotate))*this.iSpeed}.bind(this),30)};var CANNON_SIZE=[null,{w:74,h:74},{w:74,h:76},{w:74,h:76},{w:74,h:83},{w:74,h:85},{w:74,h:90},{w:74,h:94}];Cannon.prototype.draw=function(t){var i=CANNON_SIZE[this.type].w,e=CANNON_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(JSON["cannon"+this.type],0,this.cur*e,i,e,-i/2,-e/2,i,e),t.restore()},Cannon.prototype.fireAction=function(){var t=setInterval(function(){this.cur++,5==this.cur&&(this.cur=0,clearInterval(t))}.bind(this),30)},Coin.prototype.draw=function(t){switch(t.save(),this.type){case 1:case 2:case 3:t.translate(this.x,this.y),t.drawImage(JSON.coinAni1,0,60*this.cur,60,60,-30,-30,60,60);break;case 4:case 5:t.translate(this.x,this.y),t.drawImage(JSON.coinAni2,0,60*this.cur,60,60,-30,-30,60,60)}t.restore()},Coin.prototype.move=function(){setInterval(function(){this.cur++,10==this.cur&&(this.cur=0)}.bind(this),30),setInterval(function(){this.x+=(50-this.x)/10,this.y+=(650-this.y)/10}.bind(this),30)};var JSON={};DieFish.prototype.draw=function(t){var i=FISH_SIZE[this.type].w,e=FISH_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),this.rotate>=90&&this.rotate<270&&t.scale(1,-1),t.drawImage(JSON["fish"+this.type],0,4*e+this.cur*e,i,e,-i/2,-e/2,i,e),t.restore()},DieFish.prototype.change=function(){setInterval(function(){this.cur++,4==this.cur&&(this.cur=0)}.bind(this),30)};var FISH_SIZE=[null,{w:55,h:37,collR:17},{w:78,h:64,collR:24},{w:72,h:56,collR:20},{w:77,h:59,collR:22},{w:107,h:122,collR:29}];Fish.prototype.draw=function(t){var i=FISH_SIZE[this.type].w,e=FISH_SIZE[this.type].h;t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),this.rotate>=90&&this.rotate<=270&&t.scale(1,-1),t.drawImage(JSON["fish"+this.type],0,this.cur*e,i,e,-i/2,-e/2,i,e),t.restore()},Fish.prototype.move=function(){setInterval(function(){this.x+=Math.cos(d2a(this.rotate))*this.iSpeed,this.y+=Math.sin(d2a(this.rotate))*this.iSpeed}.bind(this),30),setInterval(function(){this.cur++,4==this.cur&&(this.cur=0)}.bind(this),200)},Fish.prototype.isIn=function(t,i){var e=this.x-t,n=this.y-i,s=Math.sqrt(e*e+n*n);return s<=this.collR},window.onload=function(){var t=document.getElementById("c1"),i=t.getContext("2d"),e=50,n=[-e,e],s=.05;loadImg(resource,function(){var h=[],a=[],r=[],o=[],c=[],l=new Cannon(7);setInterval(function(){if(i.clearRect(0,0,t.width,t.height),Math.random()<s){var u=new Fish(rnd(1,6));n.sort(function(){return Math.random()-.5}),n[0]<0?(u.rotate=rnd(-45,45),u.x=-e):(u.rotate=rnd(135,225),u.x=t.width+e),u.y=rnd(100,t.height-100),a.push(u)}for(var y=0;y<a.length;y++)a[y].draw(i);for(var y=0;y<r.length;y++)r[y].draw(i);for(var y=0;y<o.length;y++)o[y].draw(i);for(var y=0;y<c.length;y++)c[y].draw(i),c[y].scale+=.05,c[y].scale>=1.2&&(c.splice(y,1),y--);i.drawImage(JSON.bottom,0,0,765,70,0,532,765,70);for(var y=0;y<h.length;y++)h[y].draw(i);l.draw(i);for(var y=0;y<a.length;y++)for(var d=0;d<h.length;d++)if(a[y].isIn(h[d].x,h[d].y)){var p=a[y].type,f=a[y].x,w=a[y].y,v=a[y].rotate;a.splice(y,1),y--,h.splice(d,1),d--;var I=new Coin(p);I.x=f,I.y=w,r.push(I);var x=new DieFish(p);x.x=f,x.y=w,x.rotate=v,o.push(x),setTimeout(function(){o.splice(0,1)},300);var S=new Web;S.x=f,S.y=w,c.push(S);var g=new Audio;g.src="snd/coin.wav",g.play()}for(var y=0;y<h.length;y++)(h[y].y<=-e||h[y].x<-e||h[y].x>t.width+e||h[y].y>t.height+e)&&(h.splice(y,1),y--);for(var y=0;y<a.length;y++)(a[y].y<=-e||a[y].x<-e||a[y].x>t.width+e||a[y].y>t.height+e)&&(a.splice(y,1),y--)},16),document.onclick=function(i){var e=new Audio;e.src="snd/cannon.mp3",e.play();var n=i.clientX-t.offsetLeft-l.x,s=i.clientY-t.offsetTop-l.y,a=a2d(Math.atan2(s,n))+90;l.rotate=a,l.fireAction();var r=new Bullet(l.type);r.x=l.x,r.y=l.y,r.rotate=l.rotate,h.push(r)}})};var resource=["fish1","fish2","fish3","fish4","fish5","bottom","cannon1","cannon2","cannon3","cannon4","cannon5","cannon6","cannon7","bullet","coinAni1","coinAni2","web"];Web.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.drawImage(JSON.web,14,413,110,110,-55,-55,110,100),t.restore()};